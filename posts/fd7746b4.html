<!DOCTYPE html><html lang="zh-CN" color-mode="light"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>现代游戏引擎 - 动态全局光照和Lumen（二十一） - 樱白</title><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="google" content="notranslate"><meta name="google-site-verification" content="eQV1-bjl_nNjXCj2YhmaG3IHeUK9wO34JUX--01e0yI"><meta name="msvalidate.01" content="81DEE48B3A7B549DEC6C5C66F0BB05C2"><meta name="keywords" content="Cherry,White,CherryWhite,博客,个人成长, games104,游戏引擎,光照,动态全局光照,Lumen"><meta name="description" content="GI基础（Global Illumination）渲染..."><meta name="author" content="樱白 - Cherry White"><link rel="icon" href="/images/icons/favicon-16x16.ico" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.ico" type="image/png" sizes="32x32"><link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.jpg" sizes="180x180"><meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333"><meta rel="msapplication-TileImage" content="/images/icons/favicon-128x128.ico"><meta rel="msapplication-TileColor" content="#000000"><link rel="canonical" href="https://cherry-white.github.io/posts/fd7746b4.html"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/lib/iconfont/iconfont.css"><link rel="stylesheet" href="/lib/fancybox/fancybox.css"><link rel="stylesheet" href="/lib/highlight/a11y-dark.css"><script>var CONFIG=window.CONFIG||{},ZHAOO=window.ZHAOO||{},CONFIG={isHome:!1,fancybox:!0,pjax:!1,loading:{gif:"/images/theme/loading.gif",lottie:""},lazyload:{enable:!0,only_post:"false",loading:{gif:"/images/theme/loading.gif",lottie:""}},donate:{enable:!0,alipay:"/images/pay/alipay.png",wechat:"/images/pay/wechat.jpg"},galleries:{enable:!0},fab:{enable:!0,always_show:!1},carrier:{enable:!0},daovoice:{enable:!1},preview:{background:{default:"",api:"https://api.mtyqx.cn/api/random.php"},motto:{default:"我在开了灯的床头下，想问问自己的心啊。",typing:!0,api:"https://v2.jinrishici.com/one.json",data_contents:'["data","content"]'}},qrcode:{enable:!0,type:"url",image:"https://pic.izhaoo.com/weapp-code.jpg"},toc:{enable:!0},scrollbar:{type:"normal"},notification:{enable:!1,delay:4500,list:"",page_white_list:"",page_black_list:""},search:{enable:!0,path:"search.xml"}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9139831305743788" crossorigin="anonymous"></script><meta name="generator" content="Hexo 7.3.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:#ff0;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style></head><body class="lock-screen"><div class="loading" id="loading"></div><nav class="navbar"><div class="left"><i class="iconfont iconhome j-navbar-back-home"></i> <i class="iconfont iconqrcode j-navbar-qrcode"></i> <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i> <i class="iconfont iconsearch j-navbar-search"></i></div><div class="center">现代游戏引擎 - 动态全局光照和Lumen（二十一）</div><div class="right"><i class="iconfont iconmenu j-navbar-menu"></i></div><div id="qrcode-navbar"></div></nav><nav class="menu"><div class="menu-container"><div class="menu-close"><i class="iconfont iconbaseline-close-px"></i></div><ul class="menu-content"><li class="menu-item"><a href="/" class="underline">首页</a></li><li class="menu-item"><a href="javascript:toRandomPost()" rel="external nofollow noreferrer" class="underline">随机</a></li><li class="menu-item"><a href="/galleries/" class="underline">画廊</a></li><li class="menu-item"><a href="/archives/" class="underline">归档</a></li><li class="menu-item"><a href="/tags/" class="underline">标签</a></li><li class="menu-item"><a href="/categories/" class="underline">分类</a></li><li class="menu-item"><a href="/about/" class="underline">关于</a></li></ul><div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io" rel="external nofollow noreferrer">Hexo</a> | Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo" rel="external nofollow noreferrer">zhaoo</a></p><p>Cherry White .All Rights Reserved Copyright © 2021</p></div></div></nav><main id="main"><div class="article-wrap"><div class="row container"><div class="col-xl-3"></div><div class="col-xl-6"><article class="article"><div class="wrap"><section class="head"><img   class="lazyload" data-original="/images/background/Dynamic%20Global%20Illumination%20and%20Lumen_Advance%20Topic.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false"><div class="head-mask"><h1 class="head-title">现代游戏引擎 - 动态全局光照和Lumen（二十一）</h1><div class="head-info"><span class="post-info-item"><i class="iconfont iconcalendar"></i>五月 11, 2023</span> <span class="post-info-item"><i class="iconfont iconfont-size"></i>5891</span></div></div></section><section class="main"><section class="content"><h2 id="GI基础（Global-Illumination）"><a href="#GI基础（Global-Illumination）" class="headerlink" title="GI基础（Global Illumination）"></a>GI基础（Global Illumination）</h2><h3 id="渲染方程式（The-Rendering-Equation）"><a href="#渲染方程式（The-Rendering-Equation）" class="headerlink" title="渲染方程式（The Rendering Equation）"></a>渲染方程式（The Rendering Equation）</h3><p><b>全局光照(global illumination, GI)</b>是渲染中的重要问题。在介绍GI在游戏引擎的实现方法前我们先回顾一下<b>渲染方程(the rendering equation)</b>：<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_01.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">渲染方程</span></p><p>可以说一切渲染问题的本质在于求解渲染方程，而求解渲染方程的难点在于方程自身的递归形式。当场景中的物体被光源照亮后，被照亮的物体又会成为新的光源再次照亮其它物体。以Cornell box为例，来自屋顶的灯光会照亮左右两侧红色和绿色的墙壁，然后墙壁反射的光线又会照亮盒子使得盒子的两侧呈现红色或是绿色，这样的现象称为<b>color bleeding</b>。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_02.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">渲染方程2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_03.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">全局光照：数十亿个光源</span></p><p>在复杂的游戏场景中通过GI会极大地提升画面表现力。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_04.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">全局光照对游戏很重要</span></p><h3 id="蒙特卡罗积分（Monte-Carlo-Integration）"><a href="#蒙特卡罗积分（Monte-Carlo-Integration）" class="headerlink" title="蒙特卡罗积分（Monte Carlo Integration）"></a>蒙特卡罗积分（Monte Carlo Integration）</h3><p>作为积分方程，求解渲染方程的经典方法是<b>Monte Carlo积分(Monte Carlo integration)</b>。对于可积函数<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.566ex" xmlns="http://www.w3.org/2000/svg" width="4.299ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 1900 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mo" transform="translate(550,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(939,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(1511,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>，我们可以通过采样的方法来逼近<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.566ex" xmlns="http://www.w3.org/2000/svg" width="4.299ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 1900 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mo" transform="translate(550,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(939,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(1511,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>的积分<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_05.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">蒙特卡罗积分</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_06.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">蒙特卡罗积分2</span></p><p><b>光线追踪(ray tracing)</b>算法的本质就是通过Monte Carlo积分来求解渲染方程。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_07.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">蒙特卡罗光线追踪（离线）</span></p><h3 id="重要性采样-Importance-Sampling"><a href="#重要性采样-Importance-Sampling" class="headerlink" title="重要性采样(Importance Sampling)"></a>重要性采样(Importance Sampling)</h3><p>Monte Carlo积分的效率和精度取决于如何设计采样的样本。当样本的数量比较少或是质量比较低时，通过光线追踪渲染出的图像往往会具有非常多的噪声。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_08.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">采样是关键</span></p><p>因此如何设计采样的分布对于提升渲染质量有着非常重要的意义，其中最简单的采样方法是均匀采样。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_09.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">采样：统一采样</span></p><p>现代高质量渲染的核心技术在于<b>重要性采样(importance sampling)<b>的大规模应用。重要性采样理论指出当我们的采样函数接近于被积函数时只需要相对少的样本就可以很好地近似被积函数的积分，而在计算Monte Carlo积分时只需要对样本按照pdf进行加权求和即可。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_10.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">概率分布函数</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_11.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">重要性采样</span></b></b></p><p>回到渲染方程中，被积函数包含余弦项<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.357ex" xmlns="http://www.w3.org/2000/svg" width="5.205ex" height="1.952ex" role="img" focusable="false" viewBox="0 -705 2300.6 862.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="63" d="M370 305T349 305T313 320T297 358Q297 381 312 396Q317 401 317 402T307 404Q281 408 258 408Q209 408 178 376Q131 329 131 219Q131 137 162 90Q203 29 272 29Q313 29 338 55T374 117Q376 125 379 127T395 129H409Q415 123 415 120Q415 116 411 104T395 71T366 33T318 2T249 -11Q163 -11 99 53T34 214Q34 318 99 383T250 448T370 421T404 357Q404 334 387 320Z"></path><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(444,0)"></path><path data-c="73" d="M295 316Q295 356 268 385T190 414Q154 414 128 401Q98 382 98 349Q97 344 98 336T114 312T157 287Q175 282 201 278T245 269T277 256Q294 248 310 236T342 195T359 133Q359 71 321 31T198 -10H190Q138 -10 94 26L86 19L77 10Q71 4 65 -1L54 -11H46H42Q39 -11 33 -5V74V132Q33 153 35 157T45 162H54Q66 162 70 158T75 146T82 119T101 77Q136 26 198 26Q295 26 295 104Q295 133 277 151Q257 175 194 187T111 210Q75 227 54 256T33 318Q33 357 50 384T93 424T143 442T187 447H198Q238 447 268 432L283 424L292 431Q302 440 314 448H322H326Q329 448 335 442V310L329 304H301Q295 310 295 316Z" transform="translate(944,0)"></path></g><g data-mml-node="mo" transform="translate(1338,0)"><path data-c="2061" d=""></path></g><g data-mml-node="msub" transform="translate(1504.7,0)"><g data-mml-node="mi"><path data-c="1D703" d="M35 200Q35 302 74 415T180 610T319 704Q320 704 327 704T339 705Q393 701 423 656Q462 596 462 495Q462 380 417 261T302 66T168 -10H161Q125 -10 99 10T60 63T41 130T35 200ZM383 566Q383 668 330 668Q294 668 260 623T204 521T170 421T157 371Q206 370 254 370L351 371Q352 372 359 404T375 484T383 566ZM113 132Q113 26 166 26Q181 26 198 36T239 74T287 161T335 307L340 324H145Q145 321 136 286T120 208T113 132Z"></path></g><g data-mml-node="mi" transform="translate(502,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container>，因此一个常见技巧是根据余弦项进行采样；类似地也可以按照BRDF来进行采样，这种采样方式对于光泽表面的物体往往有着更高的积分效率。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_12.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">重要性采样：最好的PDF渲染？</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_13.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">重要性采样：PDF是重要的</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_14.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">重要性采样：Cosine和GGX PDF</span></p><h2 id="反射阴影贴图（Reflective-Shadow-Maps-RSM）"><a href="#反射阴影贴图（Reflective-Shadow-Maps-RSM）" class="headerlink" title="反射阴影贴图（Reflective Shadow Maps - RSM）"></a>反射阴影贴图（Reflective Shadow Maps - RSM）</h2><p>尽管通过光线追踪可以解决GI的问题，但它的主要缺陷在于光线追踪基本无法应用在游戏这样有实时性要求的场景中。为了实现实时的GI人们设计了各种各样的算法来进行近似，其中最早的工作可以追溯到2005年的<b>reflective shadow maps(RSM)</b>算法。</p><p>从实现的层面上讲，RSM更接近于<b>光子映射(photon mapping)</b>。光子映射理论认为相机接收到的radiance本质是由光源发射的光子经过场景不断的吸收和反射最终的被相机捕获的结果，因此我们可以从光源出发发射大量的光子然后计算光子在场景上的分布，然后通过相机来进行收集即可。</p><p>在RSM中我们需要从光源的位置首先渲染一张shadow map，它表示场景中所有被光源直接照射的部分。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_15.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">反射阴影贴图</span></p><p>shadow map记录了这些区域在直接光照下反射的radiance，这样当我们需要考虑GI时只需要把直接光照和shadow map上记录的来自其它物体的反射光线进行相加即可。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_16.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">反射阴影贴图2</span></p><p>直接计算来自场景中其它物体的反射光线仍然需要非常多的计算量，在RSM中使用了<b>cone tracing</b>的技术来进行简化。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_17.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">用RSM跟踪锥体</span></p><p>由于间接光照一般来说是相对低频的，在渲染时还可以降低输出的分辨率进一步提升效率。然后在与直接光照相加时通过插值的方式来获得完整分辨率下的间接光照。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_18.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">具有低分辨率间接光照的加速</span></p><p>通过RSM实现的GI可以明显提升游戏画面中阴影部分的细节。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_19.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">提升游戏画面中阴影部分的细节</span></p><p>总结一下，RSM作为实时GI的早期工作非常容易进行实现而且很高的计算效率；而它的缺陷在于RSM只能考虑光线的一次反射，而且在计算间接光照时没有进行可见性检测。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_20.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">RSM</span></p><h2 id="光传播体积（Light-Propagation-Volumes-LPV）"><a href="#光传播体积（Light-Propagation-Volumes-LPV）" class="headerlink" title="光传播体积（Light Propagation Volumes - LPV）"></a>光传播体积（Light Propagation Volumes - LPV）</h2><p><b>light propagation volumes(LPV)</b>是考虑光线在场景中不断传播的一种GI算法，最早在2009年提出。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_21.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">光传播体积</span></p><p>LPV的核心在于把场景使用三维的网格进行表示，并以此来计算光线在场景中的分布。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_22.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">光传播体积2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_23.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">光传播体积3</span></p><p>LPV在计算时会记录每个格子上当光线传播到物体表面后散射的radiance，然后以此为中心向其它格子进行扩散。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_24.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">“冻结”体素中的亮度</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_25.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">光线传播</span></p><p>某种意义上讲LPV把光线的传播视为扩散过程，严格来说这样的处理是不完全遵循物理法则的。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_26.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">带有“限制速度”的光</span></p><h2 id="用于实时全局的稀疏体素八叉树（Sparse-Voxel-Octree-for-Real-time-Global）"><a href="#用于实时全局的稀疏体素八叉树（Sparse-Voxel-Octree-for-Real-time-Global）" class="headerlink" title="用于实时全局的稀疏体素八叉树（Sparse Voxel Octree for Real-time Global）"></a>用于实时全局的稀疏体素八叉树（Sparse Voxel Octree for Real-time Global）</h2><p>SVOGI的思路与LPV非常接近，都使用了网格的方式来对场景空间进行划分。在SVOGI中使用了<b>保守光栅化(conservative rasterization)</b>的方法来获取场景的体素表达，从而得到场景中所有表面的体素。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_27.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">体素化过程</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_28.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">收集表面体素</span></p><p>为了更高效地管理场景中的体素，SVOGI使用了八叉树这样的数据结构来把体素组织起来。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_29.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">SVOGI</span></p><p>在进行shading时则使用了cone tracing的方式来对八叉树进行查询。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_30.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">体素树中的锥形追踪阴影</span></p><h3 id="体素基GI（Voxelization-Based-Global-Illumination）"><a href="#体素基GI（Voxelization-Based-Global-Illumination）" class="headerlink" title="体素基GI（Voxelization Based Global Illumination）"></a>体素基GI（Voxelization Based Global Illumination）</h3><p>VXGI可以看做是对SVOGI的简化。在VXGI中使用了clip map这样的数据结构来描述场景，离相机越近就具有越高的分辨率。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_31.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">体素基GI</span></p><p>当相机发生运动时无需更新clip map，只需要更新相机采样的范围即可。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_32.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">体素更新和环形寻址</span></p><p>这样整个场景就得到了一个体素化表达，离相机近的地方体素越稠密，越远的地方体素越稀疏。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_33.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">体素化表达</span><br>‘<br>对于每个体素我们还需要计算该体素遮挡了多少的光线，这里会记录体素在三个方向上的可见性。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_34.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">用于不透明的体素化</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_35.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">体素化：定向覆盖范围</span></p><p>当来自光源的光线注入到场景中时需要记录每个体素的表面上接收到的直接光照。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_36.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">光注入</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_37.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">光注入2</span></p><p>而对于屏幕上的像素则通过cone tracing的方式来计算间接光照，通过叠加整条光路上的radiance来获得间接光照。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_38.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">带圆锥跟踪的着色</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_39.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">沿着路径积累体素的光线和不透明度</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_40.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">沿着路径积累体素的光线和不透明度2</span></p><p>VXGI的主要缺陷在于cone tracing的结构仍然是对间接光照的一种近似，而且它非常容易出现漏光的问题。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_41.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">VXGI中的问题</span></p><h2 id="屏幕空间全局照明（Screen-Space-Global-Illumination-SSGI）"><a href="#屏幕空间全局照明（Screen-Space-Global-Illumination-SSGI）" class="headerlink" title="屏幕空间全局照明（Screen Space Global Illumination - SSGI）"></a>屏幕空间全局照明（Screen Space Global Illumination - SSGI）</h2><p>SSGI和前面介绍过的方法相比是基于屏幕空间的GI技术。在现代GPU渲染管线中我们可以快速地渲染出屏幕空间上的各种物理量，通过重用屏幕空间的数据就可以实现GI。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_42.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">总体思路</span></p><p>当我们渲染得到屏幕空间上的直接光照时，可以利用屏幕空间上像素的法向信息来继续计算间接光照。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_43.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">屏幕空间中的光线采样</span></p><p>计算间接光照时可以利用ray marching的方式来计算光线和平面空间中物体的交点。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_44.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">射线性行进</span></p><p>为了进一步提升ray marching的效率，SSGI还使用了z-buffer的mipmap来进行加速。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_45.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">层次追踪</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_46.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">层次追踪2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_47.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">层次追踪3</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_48.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">层次追踪4</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_49.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">层次追踪5</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_50.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">层次追踪6</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_51.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">层次追踪7</span></p><p>同时SSGI还会对每一个像素来重复使用其相邻像素采样的间接光照，这样可以减少采样的光线数量从而进一步提升渲染效率。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_52.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">邻居像素之间的光线重用</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_53.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">使用Mipmap筛选的锥体跟踪</span></p><p>和前面介绍过的基于体素的GI技术相比，SSGI对于光泽表面有非常好的渲染效果；但需要注意的是SSGI无法处理屏幕空间之外的物体，这容易导致各种错误的渲染结果。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_54.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">SSGI摘要</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_55.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">SSGI的独特优势</span></p><h2 id="流明（Lumen）"><a href="#流明（Lumen）" class="headerlink" title="流明（Lumen）"></a>流明（Lumen）</h2><p><b>Luman</b>是虚幻5引擎提出的最新实时GI技术。尽管实时光线追踪也可以实现实时GI，但它依赖于硬件层面的实现而且需要大量的采样才能实现比较好的渲染效果。而Luman不依赖于硬件实现，可以应用到大量对实时性有需求的环境中。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_56.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">光线跟踪缓慢</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_57.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">取样困难</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_58.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">低分辨率滤波场景空间探测器照亮全像素</span></p><h3 id="流明：SDF光线追踪-Fast-Ray-Trace-in-Any-Hardware"><a href="#流明：SDF光线追踪-Fast-Ray-Trace-in-Any-Hardware" class="headerlink" title="流明：SDF光线追踪(Fast Ray Trace in Any Hardware)"></a>流明：SDF光线追踪(Fast Ray Trace in Any Hardware)</h3><p>Luman的渲染过程可以大致划分为4个部分，首先是进行高效的路径追踪。考虑到不是所有的硬件都支持光线追踪的加速，Luman使用了<b>SDF</b>的方式来实现这一过程。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_59.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">什么是SDF</span></p><p>由于直接把场景转换成SDF往往是比较复杂的，我们可以先对每个物体转换为SDF。对于平移变换和等比例的放缩，物体坐标系下的SDF都可以很容易地转换为场景坐标系下的SDF。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_60.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">每个网格SDF</span></p><p>需要注意的是当物体比较薄时要进行一些额外的处理。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_61.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">薄网格的SDF</span></p><p>SDF的一大优势在于它可以非常容易地得到光线步进的长度：在任意p位置前进SDF(p)的距离总是可以保证不会和场景出现相交。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_62.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">带SDF的射线跟踪</span></p><p>同时，SDF在进行cone tracing时也可以很容易地计算出遮挡面积比例的估计。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_63.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">使用SDF的圆锥体跟踪（即软阴影）</span></p><p>生成SDF时可以考虑使用一些稀疏的数据结构进行表示。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_64.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">稀疏网格SDF</span></p><p>SDF甚至可以表达物体的不同LOD。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_65.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">网格SDF LoD</span></p><p>在低LOD下结合sparse mesh可以极大地减少模型的存储空间。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_66.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">稀疏网格SDF2</span></p><p>当然，直接将场景中物体的SDF组合到一起在进行计算时仍然是过于复杂的。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_67.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">真实场景中的光线跟踪成本</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_68.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">每条光线上都有许多物体</span></p><p>这里可以结合屏幕空间的概念只考虑相机视野范围内的物体，将它们的SDF融合为一个低精度的全局SDF。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_69.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">全局SDF</span></p><p>在这个低精度的全局SDF上进行ray tracing可以极大地降低计算压力。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_70.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">使用全局SDF的光线跟踪</span></p><p>除此之外SDF也可以结合mip的思想，近处的精度高而远处精度低。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_71.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">缓存摄影机周围的全局SDF</span></p><h3 id="流明：光辉缓存-Radiance-Injection-and-Caching"><a href="#流明：光辉缓存-Radiance-Injection-and-Caching" class="headerlink" title="流明：光辉缓存(Radiance Injection and Caching)"></a>流明：光辉缓存(Radiance Injection and Caching)</h3><p>接下来我们需要把光照信息注入到场景中。在Lumen中使用了<b>mesh card</b>来保存物体在6个正方形上被光照亮后的结果。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_72.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">网格卡-6轴对齐方向上的正交相机</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_73.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">网格卡-6轴对齐方向上的正交相机2</span></p><p>对于每个card我们还需要记录物体表面的albedo、法向以及深度等信息。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_74.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">生成表面缓存</span></p><p>所有物体的表面信息会统一记录到一张标准大小的纹理图像上，称为<b>surface cache</b>。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_75.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">生成表面缓存2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_76.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">生成表面缓存3</span></p><p>根据物体距离相机的远近还可以设置不同的card分辨率以降低存储和计算需求。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_77.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">视图相关的每对象卡片分辨率</span></p><p>我们的目标是把物体所有光照的radiance记录到surface cache上。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_78.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">我们如何才能“冻结”表面缓存上的照明</span></p><p>在Lumen中整个光照可分解为直接光照、体素化光照以及间接光照三部分。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_79.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">光照缓存管道</span></p><p>直接光照相对比较简单，我们只需要考虑光源直接照射到物体上反射的radiance即可。对于阴影中的物体则可以结合shadow map来进行处理。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_80.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">直接光照</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_81.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">直接光照2</span></p><p>得到直接光照后Lumen会对场景进行体素化来存储物体在6个方向上直接光照的亮度。而且体素化后的光照信息会在相邻帧上进行传递，随着时间的积累会得到光线多次弹射的效果。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_82.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">全局SDF无法采样表面高速缓存</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_83.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">对整个场景的光线缓存的体素剪贴图</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_84.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">通过短射线投射来构建体素面</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_85.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">通过4x4x4格子过滤大多数对象</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_86.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">将灯光注入到剪贴图中</span></p><p>最后计算间接光照时只需要从surface cache上进行采样，利用上一步体素化光照作为照明即可。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_87.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">间接光照</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_88.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">间接光照2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_89.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">具有4个探针插值的每像素间接光照</span></p><p>把直接光照和间接光照相加就得到了环境中光照的信息。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_90.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">联合光照</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_91.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">光照更新策略</span></p><h3 id="流明：内存探头（Build-a-lot-of-Probes-with-Different-Kinds）"><a href="#流明：内存探头（Build-a-lot-of-Probes-with-Different-Kinds）" class="headerlink" title="流明：内存探头（Build a lot of Probes with Different Kinds）"></a>流明：内存探头（Build a lot of Probes with Different Kinds）</h3><h4 id="屏幕空间探测器（Screen-Space-Probe）"><a href="#屏幕空间探测器（Screen-Space-Probe）" class="headerlink" title="屏幕空间探测器（Screen Space Probe）"></a>屏幕空间探测器（Screen Space Probe）</h4><p>有了光照后我们需要在物体表面通过采样来计算着色，此时我们需要在场景中放置<b>探针(probe)</b>来采样光照。Lumen中直接在屏幕空间里放置probe，每个probe会同时记录光线前进的距离以及收集到的radiance。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_92.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">屏幕探针结构</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_93.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">屏幕探针结构2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_94.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">屏幕探针放置</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_95.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">探针插值的平面距离加权</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_96.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">检测不可插值的情况</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_97.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">屏幕探测图集</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_98.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">屏幕探测图集2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_99.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">屏幕探针抖动</span></p><h4 id="重要性抽样（Importance-Sampling）"><a href="#重要性抽样（Importance-Sampling）" class="headerlink" title="重要性抽样（Importance Sampling）"></a>重要性抽样（Importance Sampling）</h4><p>为了提升渲染质量我们需要使用重要性采样的技术尽可能在比较重要的方向上进行采样。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_100.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">重要性抽样</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_101.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">重要性抽样2</span></p><p>回到Monte Carlo积分的公式中，我们需要把光线更多地分布在光照比较强或是接近物体法线的方向上。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_102.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">重要性抽样3</span></p><p>Lumen中会对上一帧以及四周相邻的probe进行平均来估计光照的分布。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_103.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">来自最后一帧探测器的近似亮度重要性</span></p><p>而对于物体法向附近的方向，Lumen会估计probe附近的法向分布。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_104.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">在附近的正态分布</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_105.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">附近的正常积累</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_106.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">结构化重要性抽样</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_107.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">基于光照和BRDF的固定预算重要性采样</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_108.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">基于光照和BRDF的固定预算重要性采样2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_109.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">基于光照和BRDF的固定预算重要性采样3</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_110.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">基于光照和BRDF的固定预算重要性采样4</span></p><h4 id="去噪和空间探测滤波（Denoising-and-Spatial-Probe-Filtering）"><a href="#去噪和空间探测滤波（Denoising-and-Spatial-Probe-Filtering）" class="headerlink" title="去噪和空间探测滤波（Denoising and Spatial Probe Filtering）"></a>去噪和空间探测滤波（Denoising and Spatial Probe Filtering）</h4><p>为了进一步提升渲染效果我们还需要对图像进行滤波降噪。<br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_111.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">去噪：探测器的空间滤波</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_112.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">去噪：从邻居那里收集光线</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_113.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">去噪：从邻居那里收集光线2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_114.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">夹角距离不匹配</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_115.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">夹角距离不匹配2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_116.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">夹角距离不匹配3</span></p><h4 id="世界空间探测器和射线连接（World-Space-Probes-and-Ray-Connecting）"><a href="#世界空间探测器和射线连接（World-Space-Probes-and-Ray-Connecting）" class="headerlink" title="世界空间探测器和射线连接（World Space Probes and Ray Connecting）"></a>世界空间探测器和射线连接（World Space Probes and Ray Connecting）</h4><p><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_117.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">世界空间光线缓存</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_118.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">世界空间光线缓存2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_119.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">连接射线</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_120.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">连接射线2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_121.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">连接射线3</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_122.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">连接射线4</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_123.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">连接射线5</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_124.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">放置和缓存</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_125.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">没有世界空间探测器</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_126.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">有世界空间探测器</span></p><h3 id="流明：阴影（Shading-Full-Pixels-with-Screen-Space-Probes）"><a href="#流明：阴影（Shading-Full-Pixels-with-Screen-Space-Probes）" class="headerlink" title="流明：阴影（Shading Full Pixels with Screen Space Probes）"></a>流明：阴影（Shading Full Pixels with Screen Space Probes）</h3><p><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_127.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">使用屏幕空间探测器着色全像素</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_128.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">与SH的最终集成</span></p><h3 id="流明：性能与结果（Overall-Performance-and-Result）"><a href="#流明：性能与结果（Overall-Performance-and-Result）" class="headerlink" title="流明：性能与结果（Overall, Performance and Result）"></a>流明：性能与结果（Overall, Performance and Result）</h3><p><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_129.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">不同跟踪方法的速度</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_130.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">SDF生成</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_131.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">过程</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_132.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">SSGI关闭</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_133.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">SSGI开启</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_134.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">表现</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_135.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">表现2</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_136.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">表现3</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_137.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">表现4</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_138.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">表现5</span><br><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_139.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">表现6</span></p><h2 id="结论（Conclusion）"><a href="#结论（Conclusion）" class="headerlink" title="结论（Conclusion）"></a>结论（Conclusion）</h2><p><img   class="lazyload" data-original="/images/article/Games104/21/Games104_21_140.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ><span class="image-caption">真实渲染的复杂性</span></p><h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://peng00bo00.github.io/2022/10/09/GAMES104-NOTES-21.html">参考文章</a></p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.bilibili.com/video/BV1oe411u7DJ/?spm_id_from=333.788&vd_source=371bc0e94a8c97f991c4ac20af0b2d53">课程视频</a></p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.bilibili.com/video/BV1Ya411g7Th/?spm_id_from=333.788&vd_source=371bc0e94a8c97f991c4ac20af0b2d53">课程视频2</a></p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://cdn.boomingtech.com/games104_static/upload/GAMES104_Lecture21_Dynamic%20Global%20Illumination%20and%20Lumen_Advance%20Topic.pdf">课件PPT</a></p></section><section class="extra"><ul class="copyright"><li><strong>本文作者：</strong>樱白 - Cherry White</li><li><strong>本文链接：</strong><a href="https://cherry-white.github.io/posts/fd7746b4.html" title="https:&#x2F;&#x2F;cherry-white.github.io&#x2F;posts&#x2F;fd7746b4.html">https:&#x2F;&#x2F;cherry-white.github.io&#x2F;posts&#x2F;fd7746b4.html</a></li><li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener external nofollow noreferrer">BY-NC-SA</a> 许可协议，转载请注明出处！</li></ul><section class="donate"><div id="qrcode-donate"><img   class="lazyload" data-original="/images/pay/alipay.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ></div><div class="icon"><a href="javascript:;" rel="external nofollow noreferrer" id="alipay"><i class="iconfont iconalipay"></i></a> <a href="javascript:;" rel="external nofollow noreferrer" id="wechat"><i class="iconfont iconwechat-fill"></i></a></div></section><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/games104/" rel="tag">games104</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/" rel="tag">游戏引擎</a></li></ul><nav class="nav"><a href="/posts/647e170e.html"><i class="iconfont iconleft"></i>现代游戏引擎 - GPU驱动的几何管线-Nanite（二十二）</a> <a href="/posts/8a707622.html">现代游戏引擎 - 面向数据编程与任务系统（二十）<i class="iconfont iconright"></i></a></nav></section><section class="comments"><div class="btn" id="comments-btn">查看评论</div><link rel="stylesheet" href="/lib/gitalk/gitalk.css"><div id="gitalk" class="gitalk"></div><script src="/lib/gitalk/gitalk.js"></script><script>const title=window.location.pathname.substring(0,50);window.onload=function(){const e=new Gitalk({clientID:"5d2553717eea46759e10",clientSecret:"4d93ce39e65dd2c5b9e364f75d06efd73c64a8ba",id:title,repo:"cherry-white.github.io",owner:"cherry-white",admin:"cherry-white",proxy:"https://vercel.prohibitorum.top/github_access_token"});$("#comments-btn").on("click",function(){$(this).hide(),e.render("gitalk")})}</script></section></section></div></article></div><div class="col-xl-3"><aside class="toc-wrap"><h3 class="toc-title">文章目录：</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#GI%E5%9F%BA%E7%A1%80%EF%BC%88Global-Illumination%EF%BC%89"><span class="toc-text">GI基础（Global Illumination）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E6%96%B9%E7%A8%8B%E5%BC%8F%EF%BC%88The-Rendering-Equation%EF%BC%89"><span class="toc-text">渲染方程式（The Rendering Equation）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%92%99%E7%89%B9%E5%8D%A1%E7%BD%97%E7%A7%AF%E5%88%86%EF%BC%88Monte-Carlo-Integration%EF%BC%89"><span class="toc-text">蒙特卡罗积分（Monte Carlo Integration）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E6%80%A7%E9%87%87%E6%A0%B7-Importance-Sampling"><span class="toc-text">重要性采样(Importance Sampling)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E9%98%B4%E5%BD%B1%E8%B4%B4%E5%9B%BE%EF%BC%88Reflective-Shadow-Maps-RSM%EF%BC%89"><span class="toc-text">反射阴影贴图（Reflective Shadow Maps - RSM）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%89%E4%BC%A0%E6%92%AD%E4%BD%93%E7%A7%AF%EF%BC%88Light-Propagation-Volumes-LPV%EF%BC%89"><span class="toc-text">光传播体积（Light Propagation Volumes - LPV）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E4%BA%8E%E5%AE%9E%E6%97%B6%E5%85%A8%E5%B1%80%E7%9A%84%E7%A8%80%E7%96%8F%E4%BD%93%E7%B4%A0%E5%85%AB%E5%8F%89%E6%A0%91%EF%BC%88Sparse-Voxel-Octree-for-Real-time-Global%EF%BC%89"><span class="toc-text">用于实时全局的稀疏体素八叉树（Sparse Voxel Octree for Real-time Global）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%93%E7%B4%A0%E5%9F%BAGI%EF%BC%88Voxelization-Based-Global-Illumination%EF%BC%89"><span class="toc-text">体素基GI（Voxelization Based Global Illumination）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%8F%E5%B9%95%E7%A9%BA%E9%97%B4%E5%85%A8%E5%B1%80%E7%85%A7%E6%98%8E%EF%BC%88Screen-Space-Global-Illumination-SSGI%EF%BC%89"><span class="toc-text">屏幕空间全局照明（Screen Space Global Illumination - SSGI）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E6%98%8E%EF%BC%88Lumen%EF%BC%89"><span class="toc-text">流明（Lumen）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E6%98%8E%EF%BC%9ASDF%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA-Fast-Ray-Trace-in-Any-Hardware"><span class="toc-text">流明：SDF光线追踪(Fast Ray Trace in Any Hardware)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E6%98%8E%EF%BC%9A%E5%85%89%E8%BE%89%E7%BC%93%E5%AD%98-Radiance-Injection-and-Caching"><span class="toc-text">流明：光辉缓存(Radiance Injection and Caching)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E6%98%8E%EF%BC%9A%E5%86%85%E5%AD%98%E6%8E%A2%E5%A4%B4%EF%BC%88Build-a-lot-of-Probes-with-Different-Kinds%EF%BC%89"><span class="toc-text">流明：内存探头（Build a lot of Probes with Different Kinds）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E6%98%8E%EF%BC%9A%E9%98%B4%E5%BD%B1%EF%BC%88Shading-Full-Pixels-with-Screen-Space-Probes%EF%BC%89"><span class="toc-text">流明：阴影（Shading Full Pixels with Screen Space Probes）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E6%98%8E%EF%BC%9A%E6%80%A7%E8%83%BD%E4%B8%8E%E7%BB%93%E6%9E%9C%EF%BC%88Overall-Performance-and-Result%EF%BC%89"><span class="toc-text">流明：性能与结果（Overall, Performance and Result）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA%EF%BC%88Conclusion%EF%BC%89"><span class="toc-text">结论（Conclusion）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-text">引用</span></a></li></ol></aside></div></div></div></main><footer class="footer"><div class="footer-social"><a href="tencent://message/?Menu=yes&uin=1789139001" target="_blank" class="footer-social-item" onmouseover='this.style.color="#12B7F5"' onmouseout='this.style.color="#33333D"'><i class="iconfont iconQQ"></i> </a><a href="/images/contact/wechat.jpg" target="_blank" class="footer-social-item" onmouseover='this.style.color="#09BB07"' onmouseout='this.style.color="#33333D"'><i class="iconfont iconwechat-fill"></i> </a><a href="https://cherry-white.github.io/" target="_blank" class="footer-social-item" onmouseover='this.style.color="#DA2E76"' onmouseout='this.style.color="#33333D"'><i class="iconfont iconinstagram"></i> </a><a href="https://gitee.com/zj1789139001" target="_blank" class="footer-social-item" onmouseover='this.style.color="#9f7be1"' onmouseout='this.style.color="#33333D"'><i class="iconfont icongithub-fill"></i> </a><a href="mailto:1789139001@qq.com" target="_blank" class="footer-social-item" onmouseover="this.style.color=#FF3B00" onmouseout='this.style.color="#33333D"'><i class="iconfont iconmail"></i></a></div><div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io" rel="external nofollow noreferrer">Hexo</a> | Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo" rel="external nofollow noreferrer">zhaoo</a></p><p>Cherry White .All Rights Reserved Copyright © 2021</p></div></footer><div class="fab fab-plus"><i class="iconfont iconplus"></i></div><a href="https://support.qq.com/product/368715" rel="external nofollow noreferrer" target="_blank"><div class="fab fab-tencent-chao"><i class="iconfont iconcomment"></i></div></a><div class="fab fab-up"><i class="iconfont iconcaret-up"></i></div><script src="/js/color-mode.js"></script><div class="search"><div class="search-container"><div class="search-close"><i class="iconfont iconbaseline-close-px"></i></div><div class="search-input-wrapper"><i class="search-input-icon iconfont iconsearch"></i> <input class="search-input" type="search" id="search-input" placeholder="Search..." autofocus autocomplete="off" autocorrect="off" autocapitalize="off"></div><div class="search-output" id="search-output"></div></div></div></body><script src="/lib/jquery/jquery.js"></script><script src="/lib/lazyload/lazyload.js"></script><script src="/lib/fancybox/fancybox.js"></script><script src="/lib/qrcode/qrcode.js"></script><script src="/js/utils.js"></script><script src="/js/script.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0],e=(t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",document.getElementsByTagName("script")[0]);e.parentNode.insertBefore(t,e)}()</script><script defer src="https://hm.baidu.com/hm.js?3cbbee458915615f7e2e5b7a073f2113"></script><script src="https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script><script src="/random.js"></script></html>